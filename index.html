<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OM HEALTH CARE — Payment</title>

<!-- Tailwind CDN -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- QR Code Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>

<style>
body {
  background-color: #f8fafc;
  font-family: system-ui, -apple-system, sans-serif;
}

.loader {
  border: 4px solid #f3f4f6;
  border-top: 4px solid #4f46e5;
  border-radius: 50%;
  width: 55px;
  height: 55px;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.ripple {
  position: relative;
  overflow: hidden;
}

.ripple:after {
  content: "";
  position: absolute;
  border-radius: 50%;
  transform: scale(0);
  opacity: 0.25;
  background: rgba(0, 0, 0, 0.2);
  width: 120px;
  height: 120px;
  pointer-events: none;
  transition: transform 600ms ease-out, opacity 600ms ease-out;
}

.ripple:active:after {
  transform: scale(1);
  opacity: 0;
  transition: 0s;
}

.backdropFade {
  animation: fadeIn 0.25s ease both;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.slideUp {
  animation: slideUp 0.28s ease;
}

@keyframes slideUp {
  from { 
    opacity: 0;
    transform: translateY(25px);
  }
  to { 
    opacity: 1;
    transform: translateY(0);
  }
}

.app-logo {
  width: 48px;
  height: 48px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 12px;
  color: white;
}

.gpay-logo { 
  background: linear-gradient(135deg, #4285F4, #34A853);
}
.phonepe-logo { 
  background: linear-gradient(135deg, #5F259F, #8B5FCC);
}
.paytm-logo { 
  background: linear-gradient(135deg, #002E6E, #0044CC);
}
.bhim-logo { 
  background: linear-gradient(135deg, #3B82F6, #60A5FA);
}

.sbi-bank {
  background: linear-gradient(135deg, #4caf50, #66bb6a);
  color: white;
}

.hdfc-bank {
  background: linear-gradient(135deg, #004c8c, #0066cc);
  color: white;
}

.icici-bank {
  background: linear-gradient(135deg, #ff6b00, #ff8c00);
  color: white;
}

.axis-bank {
  background: linear-gradient(135deg, #981e32, #c12b3d);
  color: white;
}

.payment-tab {
  transition: all 0.3s ease;
  border-bottom: 3px solid transparent;
}

.payment-tab.active {
  border-bottom-color: #4f46e5;
  color: #4f46e5;
  font-weight: 600;
}

.qr-code {
  width: 200px;
  height: 200px;
  border: 2px solid #e5e7eb;
  border-radius: 12px;
}

.instruction-box {
  background: #f0f9ff;
  border: 1px solid #bae6fd;
  border-radius: 12px;
  padding: 16px;
  margin: 16px 0;
}
</style>
</head>

<body class="min-h-screen bg-gray-50">

<!-- MAIN APP -->
<div id="app" class="min-h-screen flex flex-col">

  <!-- HEADER -->
  <header class="bg-white shadow-sm rounded-b-2xl">
    <div class="max-w-3xl mx-auto px-6 py-6 flex items-center gap-4">
      <div class="w-20 h-20 rounded-xl border-2 border-blue-500 flex items-center justify-center bg-blue-50">
        <span class="text-blue-600 font-bold text-2xl">OM</span>
      </div>
      <div>
        <h1 class="text-2xl font-bold text-gray-800">OM HEALTH CARE</h1>
        <p class="text-sm text-gray-600">Medicine & General Store</p>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="flex-1 flex items-center justify-center px-4 py-8">
    <div class="w-full max-w-3xl">

      <section class="bg-white rounded-2xl shadow-sm p-6 md:p-8 border border-gray-200">
        <div class="flex flex-col md:flex-row items-center gap-6">
          <div class="flex-1">
            <p class="text-sm text-gray-600">Payable Amount</p>
            <h2 class="mt-3 text-4xl font-bold text-gray-900">₹ <span id="amountDisplay">1.00</span></h2>
            
            <!-- Product Information -->
            <div class="mt-4 p-4 bg-blue-50 rounded-xl border border-gray-200">
              <h3 class="font-semibold text-gray-800">Fortifier Vitamin</h3>
              <p class="text-sm text-gray-600 mt-1">Payment to: OM HEALTH CARE</p>
              <p class="text-xs text-gray-600 mt-1">UPI ID: <span id="upiShownMain">bhaveshsutharb830@okhdfcbank</span></p>
            </div>
            
            <!-- Payment Info -->
            <div class="mt-4 p-4 bg-green-50 rounded-xl border border-green-200">
              <div class="flex items-start">
                <svg class="w-5 h-5 text-green-600 mt-0.5 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                </svg>
                <div>
                  <p class="font-semibold text-green-800">Instant Payment Receiving</p>
                  <p class="text-green-700 text-sm mt-1">All payments go directly to your HDFC bank account instantly</p>
                </div>
              </div>
            </div>

            <!-- Manual Payment Section -->
            <div class="mt-4 p-4 bg-blue-50 rounded-xl border border-blue-200">
              <h4 class="font-semibold text-blue-800 text-lg">Manual Payment Option</h4>
              <p class="text-blue-700 mt-2">If automatic payment fails:</p>
              <ol class="text-blue-700 mt-3 list-decimal list-inside space-y-2">
                <li>Open your UPI app</li>
                <li>Enter UPI ID: <strong class="text-blue-900">bhaveshsutharb830@okhdfcbank</strong></li>
                <li>Enter amount: ₹1.00</li>
                <li>Add note: "Fortifier Vitamin"</li>
                <li>Complete payment</li>
              </ol>
              <div class="mt-4 flex gap-3">
                <button id="copyUpiBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 ripple">
                  Copy UPI ID
                </button>
                <button id="manualSuccessBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 ripple">
                  I've Paid Manually
                </button>
              </div>
            </div>
          </div>

          <div class="w-full md:w-72">
            <button id="payNow"
              class="ripple w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white py-4 rounded-xl text-lg font-semibold transition-all duration-200 shadow-md hover:shadow-lg active:scale-95">
              Pay Now
            </button>
          </div>
        </div>
      </section>

      <!-- UPI Logos -->
      <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="bg-white p-4 rounded-2xl shadow-sm flex items-center gap-3 border border-gray-200">
          <div class="app-logo gpay-logo">G Pay</div>
          <div><div class="font-semibold text-gray-800">Google Pay</div></div>
        </div>

        <div class="bg-white p-4 rounded-2xl shadow-sm flex items-center gap-3 border border-gray-200">
          <div class="app-logo phonepe-logo">PhonePe</div>
          <div><div class="font-semibold text-gray-800">PhonePe</div></div>
        </div>

        <div class="bg-white p-4 rounded-2xl shadow-sm flex items-center gap-3 border border-gray-200">
          <div class="app-logo paytm-logo">Paytm</div>
          <div><div class="font-semibold text-gray-800">Paytm UPI</div></div>
        </div>
      </div>

      <p class="text-center text-sm text-gray-600 mt-6">
        UPI ID: <b class="text-gray-800">bhaveshsutharb830@okhdfcbank</b>
      </p>

    </div>
  </main>
</div>

<!-- PAYMENT POPUP -->
<div id="paymentModal" class="fixed inset-0 z-40 hidden items-center justify-center backdropFade p-4">
  <div class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>

  <div class="relative w-full max-w-lg mx-auto slideUp bg-white rounded-2xl p-6 shadow-xl border border-gray-200 max-h-[90vh] overflow-y-auto">

    <div class="flex justify-between items-start">
      <div>
        <h3 class="text-xl font-bold text-gray-800">Choose Payment Method</h3>
        <p class="text-sm text-gray-600 mt-1">Tap an app to pay ₹1.00</p>
      </div>
      <button id="closeModal" class="text-gray-400 hover:text-gray-600 transition">✕</button>
    </div>

    <!-- Payment Tabs -->
    <div class="flex border-b border-gray-200 mt-4">
      <button id="upiTab" class="payment-tab active flex-1 py-3 px-4 text-center font-medium">
        UPI Apps
      </button>
      <button id="bankTab" class="payment-tab flex-1 py-3 px-4 text-center font-medium text-gray-500">
        Net Banking
      </button>
    </div>

    <!-- UPI Apps Section -->
    <div id="upiSection" class="mt-4">
      <!-- Instruction Box -->
      <div class="instruction-box">
        <div class="flex items-start">
          <svg class="w-5 h-5 text-blue-600 mt-0.5 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
          </svg>
          <div>
            <p class="font-semibold text-blue-800">Click any UPI app below</p>
            <p class="text-blue-700 text-sm mt-1">If app doesn't open automatically, use the QR code or manual payment</p>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-3 mt-4">
        <button class="upiBtn ripple bg-gray-50 p-4 rounded-xl flex items-center gap-3 border border-gray-200 hover:border-blue-400 transition-all duration-200 active:scale-95" data-app="gpay">
          <div class="app-logo gpay-logo">G Pay</div>
          <div><div class="font-semibold text-gray-800">GPay</div></div>
        </button>

        <button class="upiBtn ripple bg-gray-50 p-4 rounded-xl flex items-center gap-3 border border-gray-200 hover:border-blue-400 transition-all duration-200 active:scale-95" data-app="phonepe">
          <div class="app-logo phonepe-logo">PhonePe</div>
          <div><div class="font-semibold text-gray-800">PhonePe</div></div>
        </button>

        <button class="upiBtn ripple bg-gray-50 p-4 rounded-xl flex items-center gap-3 border border-gray-200 hover:border-blue-400 transition-all duration-200 active:scale-95" data-app="paytm">
          <div class="app-logo paytm-logo">Paytm</div>
          <div><div class="font-semibold text-gray-800">Paytm</div></div>
        </button>

        <button class="upiBtn ripple bg-gray-50 p-4 rounded-xl flex items-center gap-3 border border-gray-200 hover:border-blue-400 transition-all duration-200 active:scale-95" data-app="bhim">
          <div class="app-logo bhim-logo">BHIM</div>
          <div><div class="font-semibold text-gray-800">BHIM</div></div>
        </button>
      </div>

      <p class="text-xs text-gray-600 text-center mt-4 break-all">
        UPI ID: <b class="text-gray-800">bhaveshsutharb830@okhdfcbank</b>
      </p>

      <!-- QR Code Section -->
      <div class="mt-6 text-center">
        <h3 class="text-lg font-semibold text-gray-800">OR Scan QR Code</h3>
        <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-200 mt-4 inline-block">
          <canvas id="qrCodeCanvas" class="qr-code"></canvas>
        </div>
        <p class="text-sm text-gray-600 mt-3">Scan using any UPI app</p>
      </div>
    </div>

    <!-- Net Banking Section -->
    <div id="bankSection" class="mt-4 hidden">
      <div class="instruction-box">
        <div class="flex items-start">
          <svg class="w-5 h-5 text-blue-600 mt-0.5 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
          </svg>
          <div>
            <p class="font-semibold text-blue-800">Manual Net Banking Required</p>
            <p class="text-blue-700 text-sm mt-1">Open your bank app and send payment to our UPI ID.</p>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-3 mt-4">
        <button class="bankBtn ripple touch-button sbi-bank p-3 rounded-xl flex items-center gap-2 border border-gray-200 transition-all duration-200 active:scale-95" data-bank="sbi">
          <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center">
            <span class="text-green-600 font-bold text-sm">SBI</span>
          </div>
          <div class="text-left">
            <div class="font-semibold text-white text-sm">SBI Yono</div>
          </div>
        </button>

        <button class="bankBtn ripple touch-button hdfc-bank p-3 rounded-xl flex items-center gap-2 border border-gray-200 transition-all duration-200 active:scale-95" data-bank="hdfc">
          <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center">
            <span class="text-blue-600 font-bold text-sm">HDFC</span>
          </div>
          <div class="text-left">
            <div class="font-semibold text-white text-sm">HDFC Bank</div>
          </div>
        </button>

        <button class="bankBtn ripple touch-button icici-bank p-3 rounded-xl flex items-center gap-2 border border-gray-200 transition-all duration-200 active:scale-95" data-bank="icici">
          <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center">
            <span class="text-orange-600 font-bold text-sm">ICICI</span>
          </div>
          <div class="text-left">
            <div class="font-semibold text-white text-sm">ICICI Bank</div>
          </div>
        </button>

        <button class="bankBtn ripple touch-button axis-bank p-3 rounded-xl flex items-center gap-2 border border-gray-200 transition-all duration-200 active:scale-95" data-bank="axis">
          <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center">
            <span class="text-red-600 font-bold text-sm">AXIS</span>
          </div>
          <div class="text-left">
            <div class="font-semibold text-white text-sm">Axis Mobile</div>
          </div>
        </button>
      </div>

      <div class="mt-4 text-center">
        <button id="copyUpiBankBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-all duration-200 ripple">
          Copy UPI ID for Net Banking
        </button>
      </div>
    </div>

  </div>
</div>

<!-- LOADER SCREEN -->
<div id="loaderScreen" class="fixed inset-0 hidden z-50 bg-white flex flex-col items-center justify-center p-4">
  <div class="loader"></div>
  <p class="mt-6 text-gray-800 font-semibold text-lg text-center" id="loaderText">Opening Payment App...</p>
  <p class="text-sm text-gray-600 mt-1 text-center" id="loaderSubtext">Please wait while we redirect you</p>
  
  <div class="mt-6 space-y-3 w-full max-w-xs">
    <button id="retryBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg font-medium transition-all duration-200 ripple">
      Retry Opening App
    </button>
    <button id="useQRBtn" class="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded-lg font-medium transition-all duration-200 ripple">
      Use QR Code Instead
    </button>
    <button id="manualPayBtn" class="w-full bg-gray-600 hover:bg-gray-700 text-white px-4 py-3 rounded-lg font-medium transition-all duration-200 ripple">
      Pay Manually
    </button>
  </div>
</div>

<!-- SUCCESS SCREEN -->
<div id="successScreen" class="fixed inset-0 hidden z-50 bg-white flex items-center justify-center p-4">
  <div class="text-center max-w-sm w-full">
    <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
      <span class="text-2xl text-green-600">✓</span>
    </div>
    <h2 class="mt-2 text-2xl font-bold text-gray-800">Payment Successful!</h2>
    <p class="mt-2 text-gray-600">Thank you for your payment to <b>OM HEALTH CARE</b>.</p>
    <div class="mt-4 p-4 bg-green-50 rounded-xl border border-green-200">
      <p class="text-sm font-semibold text-green-800">Money Received!</p>
      <p class="text-xs text-green-700 mt-1">Amount: ₹1.00 credited to your account</p>
      <p class="text-xs text-green-700">Status: Completed</p>
    </div>
    <button id="doneBtn" class="mt-6 w-full bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-xl shadow-md ripple active:scale-95 transition-all duration-200">
      Done
    </button>
  </div>
</div>

<!-- ERROR SCREEN -->
<div id="errorScreen" class="fixed inset-0 hidden z-50 bg-white flex items-center justify-center p-4">
  <div class="text-center max-w-sm w-full">
    <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
      <span class="text-2xl text-red-600">⚠️</span>
    </div>
    <h2 class="mt-2 text-2xl font-bold text-gray-800">App Not Opened</h2>
    <p class="mt-2 text-gray-600 text-center" id="errorMessage">The payment app couldn't be opened automatically.</p>
    <div class="mt-4 p-4 bg-blue-50 rounded-xl border border-blue-200 text-left">
      <p class="text-sm font-semibold text-blue-800">Try these options:</p>
      <ul class="text-xs text-blue-700 mt-1 list-disc list-inside space-y-1">
        <li>Open your UPI app manually</li>
        <li>Use the QR code to scan and pay</li>
        <li>Copy UPI ID and pay manually</li>
        <li>Try a different payment method</li>
      </ul>
    </div>
    <div class="mt-6 flex gap-3">
      <button id="tryOtherMethodBtn" class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-800 px-4 py-3 rounded-xl shadow-sm ripple transition-all duration-200">
        Try Another Method
      </button>
      <button id="retryPaymentBtn" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-xl shadow-md ripple transition-all duration-200">
        Retry
      </button>
    </div>
  </div>
</div>

<script>
// Constants
const UPI_ID = "bhaveshsutharb830@okhdfcbank";
const AMOUNT = 1.00;

// Global variables to track current payment attempt
let currentPaymentAttempt = null;

// Initialize DOM elements after page load
document.addEventListener('DOMContentLoaded', function() {
  initializeApp();
});

function initializeApp() {
  // Set initial values
  document.getElementById('amountDisplay').textContent = AMOUNT.toFixed(2);
  document.getElementById('upiShownMain').textContent = UPI_ID;
  
  // Pay Now Button
  document.getElementById('payNow').addEventListener('click', function() {
    document.getElementById('paymentModal').classList.remove('hidden');
    generateRealQRCode();
  });

  // Close Modal Button
  document.getElementById('closeModal').addEventListener('click', function() {
    document.getElementById('paymentModal').classList.add('hidden');
  });

  // Tab Switching
  document.getElementById('upiTab').addEventListener('click', function() {
    switchToTab('upi');
  });

  document.getElementById('bankTab').addEventListener('click', function() {
    switchToTab('bank');
  });

  // UPI Buttons
  document.querySelectorAll('.upiBtn').forEach(btn => {
    btn.addEventListener('click', function() {
      const app = this.getAttribute('data-app');
      currentPaymentAttempt = { type: 'upi', app: app };
      processUPIPayment(app);
    });
  });

  // Bank Buttons
  document.querySelectorAll('.bankBtn').forEach(btn => {
    btn.addEventListener('click', function() {
      const bank = this.getAttribute('data-bank');
      currentPaymentAttempt = { type: 'bank', bank: bank };
      processBankPayment(bank);
    });
  });

  // Copy UPI ID Buttons
  document.getElementById('copyUpiBtn').addEventListener('click', copyUPIID);
  document.getElementById('copyUpiBankBtn').addEventListener('click', copyUPIID);

  // Manual Success Button
  document.getElementById('manualSuccessBtn').addEventListener('click', function() {
    showSuccess();
  });

  // Success/Done Button
  document.getElementById('doneBtn').addEventListener('click', function() {
    document.getElementById('successScreen').classList.add('hidden');
  });

  // Error Screen Buttons
  document.getElementById('tryOtherMethodBtn').addEventListener('click', function() {
    document.getElementById('errorScreen').classList.add('hidden');
    document.getElementById('paymentModal').classList.remove('hidden');
  });

  document.getElementById('retryPaymentBtn').addEventListener('click', function() {
    document.getElementById('errorScreen').classList.add('hidden');
    if (currentPaymentAttempt) {
      if (currentPaymentAttempt.type === 'upi') {
        processUPIPayment(currentPaymentAttempt.app);
      } else {
        processBankPayment(currentPaymentAttempt.bank);
      }
    } else {
      document.getElementById('paymentModal').classList.remove('hidden');
    }
  });

  // Loader Screen Buttons
  document.getElementById('retryBtn').addEventListener('click', function() {
    if (currentPaymentAttempt) {
      if (currentPaymentAttempt.type === 'upi') {
        processUPIPayment(currentPaymentAttempt.app);
      } else {
        processBankPayment(currentPaymentAttempt.bank);
      }
    }
  });

  document.getElementById('useQRBtn').addEventListener('click', function() {
    document.getElementById('loaderScreen').classList.add('hidden');
    document.getElementById('paymentModal').classList.remove('hidden');
    switchToTab('upi');
  });

  document.getElementById('manualPayBtn').addEventListener('click', function() {
    document.getElementById('loaderScreen').classList.add('hidden');
    showError("Please open your UPI app manually and send payment to: " + UPI_ID);
  });
}

function switchToTab(tab) {
  if (tab === 'upi') {
    document.getElementById('upiTab').classList.add('active', 'text-blue-600');
    document.getElementById('bankTab').classList.remove('active', 'text-blue-600');
    document.getElementById('bankTab').classList.add('text-gray-500');
    document.getElementById('upiSection').classList.remove('hidden');
    document.getElementById('bankSection').classList.add('hidden');
  } else {
    document.getElementById('bankTab').classList.add('active', 'text-blue-600');
    document.getElementById('upiTab').classList.remove('active', 'text-blue-600');
    document.getElementById('upiTab').classList.add('text-gray-500');
    document.getElementById('bankSection').classList.remove('hidden');
    document.getElementById('upiSection').classList.add('hidden');
  }
}

// REAL QR CODE GENERATION
function generateRealQRCode() {
  const upiString = `upi://pay?pa=${UPI_ID}&pn=OM%20HEALTH%20CARE&am=${AMOUNT}&cu=INR`;
  const canvas = document.getElementById('qrCodeCanvas');
  const ctx = canvas.getContext('2d');
  
  // Set canvas size
  canvas.width = 200;
  canvas.height = 200;
  
  // Clear canvas
  ctx.fillStyle = '#FFFFFF';
  ctx.fillRect(0, 0, 200, 200);
  
  try {
    // Use the qrcode generator library
    const qr = qrcode(0, 'L');
    qr.addData(upiString);
    qr.make();
    
    const cellSize = 200 / qr.getModuleCount();
    
    // Draw QR code
    ctx.fillStyle = '#000000';
    for (let row = 0; row < qr.getModuleCount(); row++) {
      for (let col = 0; col < qr.getModuleCount(); col++) {
        if (qr.isDark(row, col)) {
          ctx.fillRect(col * cellSize, row * cellSize, cellSize, cellSize);
        }
      }
    }
    
    console.log("✅ Real QR Code Generated Successfully!");
    
  } catch (error) {
    console.error("QR Code generation failed:", error);
    // Fallback: Create a simple QR-like pattern
    createSimpleQRCode(ctx);
  }
}

function createSimpleQRCode(ctx) {
  // Create a simple QR-like pattern as fallback
  ctx.fillStyle = '#000000';
  
  // Position markers (like real QR codes)
  const positions = [[10, 10], [170, 10], [10, 170]];
  
  positions.forEach(([x, y]) => {
    // Outer square
    ctx.fillRect(x, y, 30, 30);
    // Inner white square
    ctx.fillStyle = '#FFFFFF';
    ctx.fillRect(x+5, y+5, 20, 20);
    // Inner black square
    ctx.fillStyle = '#000000';
    ctx.fillRect(x+10, y+10, 10, 10);
  });
  
  // Add text
  ctx.fillStyle = '#374151';
  ctx.font = 'bold 12px Arial';
  ctx.textAlign = 'center';
  ctx.fillText('SCAN ME', 100, 190);
}

function processUPIPayment(app) {
  const appName = getAppName(app);
  showLoader(`Opening ${appName}...`, 'If app doesn\'t open, use the options below');
  
  const upiLinks = {
    'gpay': `tez://pay?pa=${UPI_ID}&pn=OM%20HEALTH%20CARE&am=${AMOUNT}&cu=INR`,
    'phonepe': `phonepe://pay?pa=${UPI_ID}&pn=OM%20HEALTH%20CARE&am=${AMOUNT}&cu=INR`,
    'paytm': `paytmmp://pay?pa=${UPI_ID}&pn=OM%20HEALTH%20CARE&am=${AMOUNT}&cu=INR`,
    'bhim': `upiapi://pay?pa=${UPI_ID}&pn=OM%20HEALTH%20CARE&am=${AMOUNT}&cu=INR`
  };

  // Try multiple methods to open the app
  setTimeout(() => {
    const link = document.createElement('a');
    link.href = upiLinks[app];
    link.style.display = 'none';
    document.body.appendChild(link);
    
    // Method 1: Direct click
    link.click();
    
    // Method 2: Window location (fallback)
    setTimeout(() => {
      window.location.href = upiLinks[app];
    }, 100);
    
    // Method 3: Open in new tab (final fallback)
    setTimeout(() => {
      window.open(upiLinks[app], '_blank');
    }, 200);
    
    document.body.removeChild(link);
    
    // Show retry options after 2 seconds
    setTimeout(() => {
      document.getElementById('retryBtn').classList.remove('hidden');
      document.getElementById('useQRBtn').classList.remove('hidden');
      document.getElementById('manualPayBtn').classList.remove('hidden');
    }, 2000);
  }, 500);
}

function processBankPayment(bank) {
  const bankName = getBankName(bank);
  showLoader(`Opening ${bankName}...`, 'You may need to open the app manually');
  
  setTimeout(() => {
    hideLoader();
    showError(`Please open ${bankName} app manually and send payment to: ${UPI_ID}`);
  }, 2000);
}

function getAppName(app) {
  const names = {
    'gpay': 'Google Pay',
    'phonepe': 'PhonePe', 
    'paytm': 'Paytm',
    'bhim': 'BHIM'
  };
  return names[app] || 'UPI App';
}

function getBankName(bank) {
  const names = {
    'sbi': 'SBI Yono',
    'hdfc': 'HDFC Bank',
    'icici': 'ICICI Bank', 
    'axis': 'Axis Mobile'
  };
  return names[bank] || 'Bank App';
}

function copyUPIID() {
  navigator.clipboard.writeText(UPI_ID).then(() => {
    const btn = event.target;
    const originalText = btn.textContent;
    btn.textContent = 'Copied!';
    btn.style.background = '#10b981';
    setTimeout(() => {
      btn.textContent = originalText;
      btn.style.background = '';
    }, 2000);
  });
}

function showLoader(message, subtext = '') {
  document.getElementById('loaderScreen').classList.remove('hidden');
  document.getElementById('loaderText').textContent = message;
  document.getElementById('loaderSubtext').textContent = subtext;
  document.getElementById('paymentModal').classList.add('hidden');
  
  // Hide retry options initially
  document.getElementById('retryBtn').classList.add('hidden');
  document.getElementById('useQRBtn').classList.add('hidden');
  document.getElementById('manualPayBtn').classList.add('hidden');
}

function hideLoader() {
  document.getElementById('loaderScreen').classList.add('hidden');
}

function showSuccess() {
  document.getElementById('successScreen').classList.remove('hidden');
  hideLoader();
}

function showError(message) {
  document.getElementById('errorScreen').classList.remove('hidden');
  document.getElementById('errorMessage').textContent = message;
  hideLoader();
}

// Handle page visibility changes for payment simulation
document.addEventListener('visibilitychange', function() {
  if (!document.hidden) {
    // Simulate payment completion when user returns to page
    setTimeout(() => {
      if (!document.getElementById('loaderScreen').classList.contains('hidden')) {
        if (Math.random() > 0.3) {
          showSuccess();
        }
      }
    }, 1000);
  }
});
</script>
</body>
</html>
